const data = [
  {
    "World Cup": "Germany",
    Dates: "9 June - 9 July",
    "Search Interest": [
      { date: "2006-06-01", value: 13 },
      { date: "2006-06-02", value: 14 },
      { date: "2006-06-03", value: 12 },
      { date: "2006-06-04", value: 15 },
      { date: "2006-06-05", value: 20 },
      { date: "2006-06-06", value: 21 },
      { date: "2006-06-07", value: 25 },
      { date: "2006-06-08", value: 32 },
      { date: "2006-06-09", value: 100 },
      { date: "2006-06-10", value: 98 },
      { date: "2006-06-11", value: 76 },
      { date: "2006-06-12", value: 63 },
      { date: "2006-06-13", value: 56 },
      { date: "2006-06-14", value: 52 },
      { date: "2006-06-15", value: 48 },
      { date: "2006-06-16", value: 46 },
      { date: "2006-06-17", value: 48 },
      { date: "2006-06-18", value: 49 },
      { date: "2006-06-19", value: 45 },
      { date: "2006-06-20", value: 46 },
      { date: "2006-06-21", value: 43 },
      { date: "2006-06-22", value: 50 },
      { date: "2006-06-23", value: 41 },
      { date: "2006-06-24", value: 45 },
      { date: "2006-06-25", value: 42 },
      { date: "2006-06-26", value: 42 },
      { date: "2006-06-27", value: 39 },
      { date: "2006-06-28", value: 28 },
      { date: "2006-06-29", value: 19 },
      { date: "2006-06-30", value: 39 },
      { date: "2006-07-01", value: 49 },
      { date: "2006-07-02", value: 27 },
      { date: "2006-07-03", value: 18 },
      { date: "2006-07-04", value: 30 },
      { date: "2006-07-05", value: 31 },
      { date: "2006-07-06", value: 16 },
      { date: "2006-07-07", value: 12 },
      { date: "2006-07-08", value: 20 },
      { date: "2006-07-09", value: 42 },
      { date: "2006-07-10", value: 29 },
      { date: "2006-07-11", value: 11 },
      { date: "2006-07-12", value: 7 },
      { date: "2006-07-13", value: 5 },
      { date: "2006-07-14", value: 5 },
      { date: "2006-07-15", value: 5 },
      { date: "2006-07-16", value: 4 },
      { date: "2006-07-17", value: 3 },
      { date: "2006-07-18", value: 3 },
      { date: "2006-07-19", value: 3 },
      { date: "2006-07-20", value: 2 },
      { date: "2006-07-21", value: 2 },
      { date: "2006-07-22", value: 3 },
      { date: "2006-07-23", value: 2 },
      { date: "2006-07-24", value: 2 },
      { date: "2006-07-25", value: 2 },
      { date: "2006-07-26", value: 2 },
      { date: "2006-07-27", value: 2 },
      { date: "2006-07-28", value: 2 },
      { date: "2006-07-29", value: 2 },
      { date: "2006-07-30", value: 2 },
      { date: "2006-07-31", value: 1 },
    ],
  },
  {
    "World Cup": "South Africa",
    Dates: "11 June - 11 July",
    "Search Interest": [
      { date: "2010-06-01", value: 13 },
      { date: "2010-06-02", value: 12 },
      { date: "2010-06-03", value: 13 },
      { date: "2010-06-04", value: 13 },
      { date: "2010-06-05", value: 14 },
      { date: "2010-06-06", value: 16 },
      { date: "2010-06-07", value: 20 },
      { date: "2010-06-08", value: 24 },
      { date: "2010-06-09", value: 27 },
      { date: "2010-06-10", value: 42 },
      { date: "2010-06-11", value: 100 },
      { date: "2010-06-12", value: 91 },
      { date: "2010-06-13", value: 71 },
      { date: "2010-06-14", value: 71 },
      { date: "2010-06-15", value: 61 },
      { date: "2010-06-16", value: 59 },
      { date: "2010-06-17", value: 59 },
      { date: "2010-06-18", value: 63 },
      { date: "2010-06-19", value: 55 },
      { date: "2010-06-20", value: 56 },
      { date: "2010-06-21", value: 55 },
      { date: "2010-06-22", value: 60 },
      { date: "2010-06-23", value: 67 },
      { date: "2010-06-24", value: 59 },
      { date: "2010-06-25", value: 54 },
      { date: "2010-06-26", value: 56 },
      { date: "2010-06-27", value: 57 },
      { date: "2010-06-28", value: 48 },
      { date: "2010-06-29", value: 46 },
      { date: "2010-06-30", value: 29 },
      { date: "2010-07-01", value: 22 },
      { date: "2010-07-02", value: 50 },
      { date: "2010-07-03", value: 58 },
      { date: "2010-07-04", value: 32 },
      { date: "2010-07-05", value: 23 },
      { date: "2010-07-06", value: 33 },
      { date: "2010-07-07", value: 37 },
      { date: "2010-07-08", value: 21 },
      { date: "2010-07-09", value: 16 },
      { date: "2010-07-10", value: 28 },
      { date: "2010-07-11", value: 61 },
      { date: "2010-07-12", value: 27 },
      { date: "2010-07-13", value: 10 },
      { date: "2010-07-14", value: 7 },
      { date: "2010-07-15", value: 6 },
      { date: "2010-07-16", value: 5 },
      { date: "2010-07-17", value: 5 },
      { date: "2010-07-18", value: 5 },
      { date: "2010-07-19", value: 4 },
      { date: "2010-07-20", value: 3 },
      { date: "2010-07-21", value: 3 },
      { date: "2010-07-22", value: 3 },
      { date: "2010-07-23", value: 3 },
      { date: "2010-07-24", value: 3 },
      { date: "2010-07-25", value: 3 },
      { date: "2010-07-26", value: 2 },
      { date: "2010-07-27", value: 2 },
      { date: "2010-07-28", value: 2 },
      { date: "2010-07-29", value: 2 },
      { date: "2010-07-30", value: 2 },
      { date: "2010-07-31", value: 2 },
    ],
  },
  {
    "World Cup": "Brazil",
    Dates: "12 June - 13 July",
    "Search Interest": [
      { date: "2014-06-01", value: 12 },
      { date: "2014-06-02", value: 12 },
      { date: "2014-06-03", value: 13 },
      { date: "2014-06-04", value: 13 },
      { date: "2014-06-05", value: 12 },
      { date: "2014-06-06", value: 13 },
      { date: "2014-06-07", value: 15 },
      { date: "2014-06-08", value: 16 },
      { date: "2014-06-09", value: 18 },
      { date: "2014-06-10", value: 22 },
      { date: "2014-06-11", value: 33 },
      { date: "2014-06-12", value: 92 },
      { date: "2014-06-13", value: 95 },
      { date: "2014-06-14", value: 100 },
      { date: "2014-06-15", value: 97 },
      { date: "2014-06-16", value: 80 },
      { date: "2014-06-17", value: 75 },
      { date: "2014-06-18", value: 77 },
      { date: "2014-06-19", value: 75 },
      { date: "2014-06-20", value: 71 },
      { date: "2014-06-21", value: 78 },
      { date: "2014-06-22", value: 80 },
      { date: "2014-06-23", value: 75 },
      { date: "2014-06-24", value: 70 },
      { date: "2014-06-25", value: 67 },
      { date: "2014-06-26", value: 81 },
      { date: "2014-06-27", value: 48 },
      { date: "2014-06-28", value: 67 },
      { date: "2014-06-29", value: 73 },
      { date: "2014-06-30", value: 62 },
      { date: "2014-07-01", value: 69 },
      { date: "2014-07-02", value: 42 },
      { date: "2014-07-03", value: 28 },
      { date: "2014-07-04", value: 63 },
      { date: "2014-07-05", value: 68 },
      { date: "2014-07-06", value: 38 },
      { date: "2014-07-07", value: 25 },
      { date: "2014-07-08", value: 54 },
      { date: "2014-07-09", value: 57 },
      { date: "2014-07-10", value: 34 },
      { date: "2014-07-11", value: 20 },
      { date: "2014-07-12", value: 42 },
      { date: "2014-07-13", value: 98 },
      { date: "2014-07-14", value: 36 },
      { date: "2014-07-15", value: 12 },
      { date: "2014-07-16", value: 7 },
      { date: "2014-07-17", value: 5 },
      { date: "2014-07-18", value: 5 },
      { date: "2014-07-19", value: 4 },
      { date: "2014-07-20", value: 4 },
      { date: "2014-07-21", value: 3 },
      { date: "2014-07-22", value: 3 },
      { date: "2014-07-23", value: 3 },
      { date: "2014-07-24", value: 3 },
      { date: "2014-07-25", value: 2 },
      { date: "2014-07-26", value: 3 },
      { date: "2014-07-27", value: 2 },
      { date: "2014-07-28", value: 2 },
      { date: "2014-07-29", value: 2 },
      { date: "2014-07-30", value: 2 },
      { date: "2014-07-31", value: 2 },
    ],
  },
  {
    "World Cup": "Russia",
    Dates: "14 June - 15 July",
    "Search Interest": [
      { date: "2018-06-01", value: 5 },
      { date: "2018-06-02", value: 6 },
      { date: "2018-06-03", value: 7 },
      { date: "2018-06-04", value: 7 },
      { date: "2018-06-05", value: 7 },
      { date: "2018-06-06", value: 7 },
      { date: "2018-06-07", value: 7 },
      { date: "2018-06-08", value: 8 },
      { date: "2018-06-09", value: 9 },
      { date: "2018-06-10", value: 10 },
      { date: "2018-06-11", value: 13 },
      { date: "2018-06-12", value: 14 },
      { date: "2018-06-13", value: 24 },
      { date: "2018-06-14", value: 62 },
      { date: "2018-06-15", value: 72 },
      { date: "2018-06-16", value: 85 },
      { date: "2018-06-17", value: 90 },
      { date: "2018-06-18", value: 69 },
      { date: "2018-06-19", value: 63 },
      { date: "2018-06-20", value: 63 },
      { date: "2018-06-21", value: 71 },
      { date: "2018-06-22", value: 79 },
      { date: "2018-06-23", value: 87 },
      { date: "2018-06-24", value: 82 },
      { date: "2018-06-25", value: 82 },
      { date: "2018-06-26", value: 80 },
      { date: "2018-06-27", value: 100 },
      { date: "2018-06-28", value: 78 },
      { date: "2018-06-29", value: 40 },
      { date: "2018-06-30", value: 83 },
      { date: "2018-07-01", value: 90 },
      { date: "2018-07-02", value: 75 },
      { date: "2018-07-03", value: 72 },
      { date: "2018-07-04", value: 35 },
      { date: "2018-07-05", value: 24 },
      { date: "2018-07-06", value: 71 },
      { date: "2018-07-07", value: 81 },
      { date: "2018-07-08", value: 33 },
      { date: "2018-07-09", value: 21 },
      { date: "2018-07-10", value: 47 },
      { date: "2018-07-11", value: 48 },
      { date: "2018-07-12", value: 22 },
      { date: "2018-07-13", value: 16 },
      { date: "2018-07-14", value: 40 },
      { date: "2018-07-15", value: 76 },
      { date: "2018-07-16", value: 14 },
      { date: "2018-07-17", value: 5 },
      { date: "2018-07-18", value: 3 },
      { date: "2018-07-19", value: 3 },
      { date: "2018-07-20", value: 2 },
      { date: "2018-07-21", value: 2 },
      { date: "2018-07-22", value: 2 },
      { date: "2018-07-23", value: 2 },
      { date: "2018-07-24", value: 1 },
      { date: "2018-07-25", value: 1 },
      { date: "2018-07-26", value: 1 },
      { date: "2018-07-27", value: 1 },
      { date: "2018-07-28", value: 1 },
      { date: "2018-07-29", value: 1 },
      { date: "2018-07-30", value: 1 },
      { date: "2018-07-31", value: 1 },
    ],
  },
];

const width = 500;
const height = 400;
const margin = {
  top: 5,
  bottom: 20,
  left: 80,
  right: 50,
};

const timeParse = d3.timeParse("%Y-%m-%d");
const timeFormat = d3.timeFormat("%B %-d");

const ticks = 4;

const h1 = width / 2;
const h2 = width - h1;
const v1 = h1 / 2;
const v2 = h2 / 2;
const elevation = height - ((v1 + v2) / 2) * 2;

const editions = data.map((d) => d["World Cup"]);
const dates = data[0]["Search Interest"].map(({ date }) => timeParse(date));

const { length: l1 } = editions;
const g1 = h1 / l1;

const { length: l2 } = dates;
const g2 = h2 / l2;

const offsets1 = d3.range(l1).map((d) => [d * g1, (d * g1) / 2]);
const offsets2 = d3.range(l2).map((d) => [d * g2, ((d * g2) / 2) * -1]);

const scaleOffset1 = d3.scaleOrdinal().domain(editions).range(offsets1);
const scaleOffset2 = d3.scaleOrdinal().domain(dates).range(offsets2);

const ticksDates = [
  ...d3.range(ticks).map((d) => dates[Math.floor((dates.length / ticks) * d)]),
  dates[dates.length - 1],
];

const scaleElevation = d3
  .scaleLinear()
  .domain([0, d3.max(data[0]["Search Interest"], (d) => d.value)])
  .range([0, -elevation]);

const line = d3
  .line()
  .x((d) => {
    const { date } = d;

    const [x] = scaleOffset2(timeParse(date));

    return x;
  })
  .y((d) => {
    const { date, value } = d;

    const [, y] = scaleOffset2(timeParse(date));
    const elevation = scaleElevation(value);
    return y + elevation;
  });

const svg = d3
  .select("body")
  .append("svg")
  .attr(
    "viewBox",
    `0 0 ${width + margin.left + margin.right} ${
      height + margin.top + margin.bottom
    }`
  );

const group = svg
  .append("g")
  .attr(
    "transform",
    `translate(${margin.left} ${margin.top + elevation + v2})`
  );

const groupAxis = group.append("g");
const groupData = group.append("g");

groupAxis.style("color", "hsl(0, 0%, 35%)");
groupData.style("color", "hsl(0, 0%, 20%)");

const groupEditions = groupAxis.append("g");
const groupDates = groupAxis.append("g");

const groupsEditions = groupEditions
  .selectAll("g")
  .data(editions)
  .enter()
  .append("g")
  .attr("transform", (d) => {
    const [x, y] = scaleOffset1(d);
    return `translate(${x} ${y})`;
  });

// groupsEditions.append("path").attr("d", `M 0 0 l ${h2} ${-v2}`);
groupsEditions
  .append("text")
  .text((d) => d)
  .attr("x", "-8")
  .attr("y", "8")
  .attr("font-weight", "700")
  .attr("text-anchor", "end")
  .attr("dominant-baseline", "hanging");

const groupsDates = groupDates
  .selectAll("g")
  .data(ticksDates)
  .enter()
  .append("g")
  .attr("transform", (d) => {
    const [x, y] = scaleOffset2(d);
    return `translate(${x} ${y})`;
  });

groupsDates
  .append("path")
  .attr("fill", "none")
  .attr("stroke", "currentColor")
  .attr("stroke-width", "1")
  .attr("opacity", "0.5")
  .attr("d", `M 0 0 l ${h1} ${v1}`);

groupsDates
  .append("text")
  .attr("x", "8")
  .attr("y", "8")
  .attr("transform", `translate(${h1} ${v1})`)
  .attr("fill", "currentColor")
  .text((d) => timeFormat(d));

const groupsData = groupData
  .selectAll("g")
  .data(data)
  .enter()
  .append("g")
  .attr("transform", (d) => {
    const [x, y] = scaleOffset1(d["World Cup"]);
    return `translate(${x} ${y})`;
  });

groupsData
  .append("path")
  .datum((d) => d["Search Interest"])
  .attr("d", line);
